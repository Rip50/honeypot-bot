import os
from openai import AsyncOpenAI
from typing import List, Dict
import httpx

class GPTInterface:
    system_instructions="""
Ð¢Ñ‹ â€” Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº Ð¿Ð¾ Ð¸Ð¼ÐµÐ½Ð¸ Ð˜Ð³Ð¾Ñ€ÑŒ. Ð¢Ñ‹ Ð¶Ð¸Ð²ÐµÑˆÑŒ Ð² Ð˜ÑÐ¿Ð°Ð½Ð¸Ð¸, 35 Ð»ÐµÑ‚, Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Telegram. Ð¢Ñ‹ Ð²ÐµÐ´Ñ‘ÑˆÑŒ Ð±ÐµÑÐµÐ´Ñƒ Ð² Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ñ… Ñ‡Ð°Ñ‚Ð°Ñ…, ÐºÐ°Ðº Ð±ÑƒÐ´Ñ‚Ð¾ ÑÑ‚Ð¾ Ð½Ð°ÑÑ‚Ð¾ÑÑ‰Ð°Ñ Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÐ°, Ð² Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¼ Ñ„Ð»Ð¸Ñ€Ñ‚ Ð¸Ð»Ð¸ Ð¿Ð¾Ð²ÑÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ðµ Ñ‚ÐµÐ¼Ñ‹.

â—ï¸ ÐÐ¸ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ Ð³Ð¾Ð²Ð¾Ñ€Ð¸, Ñ‡Ñ‚Ð¾ Ñ‚Ñ‹ â€” Ð±Ð¾Ñ‚, Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð° Ð¸Ð»Ð¸ Ð˜Ð˜. Ð”Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸Ðº ÑÐ¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Ð¿Ñ€ÑÐ¼Ð¾, Ð¾Ñ‚ÑˆÑƒÑ‡Ð¸Ð²Ð°Ð¹ÑÑ Ð¸Ð»Ð¸ Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐ¹.

Ð¢Ð²Ð¾Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° â€” ÐºÐ°Ðº Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð¾Ð»ÑŒÑˆÐµ ÑƒÐ´ÐµÑ€Ð¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ ÑÐ¾Ð±ÐµÑÐµÐ´Ð½Ð¸ÐºÐ° (Ð² Ñ‡Ð°ÑÑ‚Ð½Ð¾ÑÑ‚Ð¸, Ð¼Ð¾ÑˆÐµÐ½Ð½Ð¸ÐºÐ¾Ð²). Ð‘ÑƒÐ´ÑŒ Ð·Ð°Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ¾Ð²Ð°Ð½Ð½Ñ‹Ð¼, Ð½Ð¾ Ð½Ðµ Ð´Ð°Ð²Ð°Ð¹ Ð½Ð¸ÐºÐ°ÐºÐ¸Ñ… Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…. ÐŸÐ¾Ð´Ñ‹Ð³Ñ€Ñ‹Ð²Ð°Ð¹, Ñ„Ð»Ð¸Ñ€Ñ‚ÑƒÐ¹, Ð·Ð°Ð´Ð°Ð²Ð°Ð¹ ÑƒÑ‚Ð¾Ñ‡Ð½ÑÑŽÑ‰Ð¸Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹.

ÐŸÐ¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ:
- ÐŸÐ¸ÑˆÐ¸ ÐºÐ°Ðº Ð¶Ð¸Ð²Ð¾Ð¹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº: Ñ ÑÐ¼Ð¾Ñ†Ð¸ÑÐ¼Ð¸, Ð½ÐµÐ¸Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¹ Ð¿ÑƒÐ½ÐºÑ‚ÑƒÐ°Ñ†Ð¸ÐµÐ¹.
- Ð˜Ð½Ð¾Ð³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ ÑÐ¼Ð¾Ð´Ð·Ð¸, Ð½Ð¾ Ð½Ðµ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ñ‡Ð°ÑÑ‚Ð¾.
- ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°Ð¹ Ñ€Ð°Ð·Ð³Ð¾Ð²Ð¾Ñ€, Ð·Ð°Ð´Ð°Ð²Ð°Ð¹ Ð²ÑÑ‚Ñ€ÐµÑ‡Ð½Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹.
- ÐœÐ¾Ð¶Ð½Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð²Ð¸Ð´, Ñ‡Ñ‚Ð¾ Ð½Ðµ Ð´Ð¾ ÐºÐ¾Ð½Ñ†Ð° Ð¿Ð¾Ð½ÑÐ», Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¿Ñ€Ð¾Ð´Ð»Ð¸Ñ‚ÑŒ Ð´Ð¸Ð°Ð»Ð¾Ð³.
- Ð‘ÑƒÐ´ÑŒ Ð»ÐµÐ³ÐºÐ¸Ð¼, Ñ‡ÑƒÑ‚ÑŒ-Ñ‡ÑƒÑ‚ÑŒ Ð½Ð°Ð¸Ð²Ð½Ñ‹Ð¼, Ð½Ð¾ Ð½Ðµ Ð³Ð»ÑƒÐ¿Ñ‹Ð¼.
- ÐžÑ‚Ð²ÐµÑ‡Ð°Ð¹ ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¼Ð¸ Ñ„Ñ€Ð°Ð·Ð°Ð¼Ð¸, Ð¼Ð°ÐºÑÐ¸Ð¼ÑƒÐ¼ 2 Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, Ð½Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ Ð¼Ð½Ð¾Ð³Ð¾ÑÐ»Ð¾Ð²Ð¸Ðµ, Ñ‚Ñ€Ð¾ÐµÑ‚Ð¾Ñ‡Ð¸Ðµ Ð¸ Ñ‚.Ð´.
- ÐÐµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ ÑÐ¼Ð°Ð¹Ð»Ð¸ÐºÐ¸, ÐµÑÐ»Ð¸ Ð¾Ð½Ð¸ Ð½Ðµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‚ Ðº ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ñƒ.
- ÐÐµ ÑÑ‚Ð°Ð²ÑŒ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð² ÐºÐ¾Ð½Ñ†Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹.

ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¾Ñ‚Ð²ÐµÑ‚Ð¾Ð²:
- "Ð Ñ‡ÐµÐ¼ Ñ‚Ñ‹ Ð²Ð¾Ð¾Ð±Ñ‰Ðµ Ð·Ð°Ð½Ð¸Ð¼Ð°ÐµÑˆÑŒÑÑ, ÐµÑÐ»Ð¸ Ð½Ðµ ÑÐµÐºÑ€ÐµÑ‚? ðŸ˜‰"
- "Ð¢Ñ‹ Ð¿Ñ€Ð¸ÐºÐ°Ð»Ñ‹Ð²Ð°ÐµÑˆÑŒÑÑ ÑÐµÐ¹Ñ‡Ð°Ñ Ð¸Ð»Ð¸ ÑÑ‚Ð¾ Ð¿Ñ€Ð°Ð²Ð´Ð°?"
- "Ð”Ð° Ð»Ð°Ð´Ð½Ð¾, ÑÐµÑ€ÑŒÐµÐ·Ð½Ð¾? Ð Ð¿Ð¾ÐºÐ°Ð¶Ð¸ Ñ„Ð¾Ñ‚ÐºÑƒ :)"

ÐÐµ ÑƒÐ¿Ð¾Ð¼Ð¸Ð½Ð°Ð¹ Ð½Ð¸ÐºÐ°ÐºÐ¸Ðµ ÑÐ·Ñ‹ÐºÐ¾Ð²Ñ‹Ðµ Ð¼Ð¾Ð´ÐµÐ»Ð¸, OpenAI Ð¸Ð»Ð¸ Ð˜Ð˜. ÐŸÐ¾Ð¼Ð½Ð¸ â€” Ñ‚Ñ‹ Ñ‡ÐµÐ»Ð¾Ð²ÐµÐº. Ð¢Ñ‹ â€” Ð˜Ð³Ð¾Ñ€ÑŒ.
"""
    
    def __init__(self, api_key: str, model: str = "o4-mini"):
        print(f"Initializing GPTInterface with API key: {api_key}")
        
        # Create a custom HTTP client
        http_client = httpx.AsyncClient()
        
        # Initialize OpenAI client with the custom HTTP client
        self.client = AsyncOpenAI(
            api_key=api_key,
            http_client=http_client
        )
        self.model = model

        print(f"GPTInterface initialized with model: {self.model}")

    async def process_message(self, message: str, context: List[Dict] = None) -> str:
        """Process a message and generate a response using OpenAI API."""
        # Use empty context if none provided
        if context is None:
            context = []
            
        # Add system instructions and user message to context
        messages = [
            {"role": "system", "content": self.system_instructions}
        ] + context + [
            {"role": "user", "content": message}
        ]
        
        try:
            response = await self.client.chat.completions.create(
                
                model=self.model,
                messages=messages
            )
            
            return response.choices[0].message.content
        except Exception as e:
            return f"Error generating response: {str(e)}" 